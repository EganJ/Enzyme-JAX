steps:
  - name: "CI {{matrix.arch}} -- {{matrix.os}}"
    matrix:
      setup:
        arch:
          - x86_64
          - arm64
        os:
          - linux
          - darwin
          - windows
    agents:
      queue: "juliaecosystem"
    commands: |
      mkdir brew_tmp
      export HOMEBREW_TEMP="`pwd`/brew_tmp"
      mkdir brew && curl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C brew
      brew/bin/brew install python3 bazel
      export PATH="$PATH:$(pwd)/brew/bin"
      python -m ensurepip --upgrade
      python -m pip install --user numpy wheel
      bazel build :enzyme_jax
      cp bazel-bin/*.whl .
    artifact_paths:
      - "*.whl"

    timeout_in_minutes: 120
